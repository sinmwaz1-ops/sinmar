<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>قنوات SINMAR+ المباشرة</title>
    <style>
        :root { --bg: #050505; --cyan: #00E5FF; --white: #FFFFFF; --card-w: 180px; --card-h: 110px; }
        body { background: var(--bg); color: var(--white); font-family: sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        /* الهيدر الثابت */
        .header { height: 120px; padding: 0 50px; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(to bottom, #000, transparent); position: sticky; top: 0; z-index: 100; }
        .logo-row { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 28px; font-weight: 900; }
        .logo span { color: var(--cyan); }
        
        /* مربع البحث */
        .search-container { margin-top: 15px; }
        .search-box { background: #151515; border: 2px solid #333; padding: 8px 20px; border-radius: 5px; width: 350px; }
        .search-box input { background: transparent; border: none; color: white; width: 100%; font-size: 16px; outline: none; }
        .search-box:focus-within { border-color: var(--cyan); }

        /* منطقة المحتوى القابلة للتمرير */
        .content { height: calc(100vh - 120px); overflow-y: auto; padding: 0 50px 50px; scroll-behavior: smooth; }
        .content::-webkit-scrollbar { width: 5px; }
        .content::-webkit-scrollbar-thumb { background: var(--cyan); }

        .group-title { font-size: 22px; font-weight: bold; margin: 30px 0 15px; color: var(--cyan); border-right: 4px solid var(--cyan); padding-right: 15px; }
        .channels-row { display: flex; gap: 20px; overflow-x: auto; padding: 10px 0; }
        .channels-row::-webkit-scrollbar { display: none; }

        /* كرت القناة (عرضي ليناسب شعارات القنوات) */
        .card { 
            min-width: var(--card-w); height: var(--card-h); background: #111; border-radius: 8px; 
            border: 3px solid transparent; transition: 0.2s; position: relative; cursor: pointer; flex-shrink: 0;
        }
        .card:focus { border-color: var(--white); transform: scale(1.1); z-index: 10; outline: none; box-shadow: 0 0 20px rgba(0,229,255,0.3); }
        .card img { width: 100%; height: 100%; object-fit: contain; padding: 10px; box-sizing: border-box; }
        .card-name { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); font-size: 11px; padding: 5px; text-align: center; white-space: nowrap; overflow: hidden; }
        
        #loader { text-align: center; padding: 100px; font-size: 24px; color: var(--cyan); }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-row">
            <div class="logo">SINMAR<span>+</span> | البث المباشر</div>
            <div style="color: #666; font-size: 14px;">استخدم الأسهم للتنقل و Back للعودة</div>
        </div>
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="بحث عن قناة..." tabindex="0">
            </div>
        </div>
    </div>

    <div id="loader">جاري جلب القنوات وترتيب الفئات...</div>
    <div class="content" id="main-content"></div>

    <script>
        let groups = {};

        async function loadLive() {
            try {
                const res = await fetch('fetch.php');
                const data = await res.text();
                parseData(data);
            } catch (e) { document.getElementById('loader').innerText = "فشل التحميل"; }
        }

        function parseData(data) {
            const lines = data.split('\n');
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes("#EXTINF")) {
                    let stream = lines[i+1]?.trim();
                    let group = lines[i].match(/group-title="([^"]+)"/)?.[1] || "قنوات منوعة";
                    
                    // استبعاد الأفلام والمسلسلات (البقاء على البث المباشر فقط)
                    const isMovie = stream.includes(".mp4") || stream.includes(".mkv");
                    const isSeries = lines[i].toLowerCase().includes("series");

                    if (!isMovie && !isSeries) {
                        if (!groups[group]) groups[group] = [];
                        groups[group].push({
                            name: lines[i].split(',').pop().trim(),
                            logo: lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "",
                            url: stream
                        });
                    }
                    i++;
                }
            }
            render(groups);
            document.getElementById('loader').style.display = 'none';
        }

        function render(dataGroups) {
            const container = document.getElementById('main-content');
            container.innerHTML = "";
            for (let gName in dataGroups) {
                if (dataGroups[gName].length === 0) continue;
                
                let section = document.createElement('div');
                section.innerHTML = `<div class="group-title">${gName}</div>`;
                let row = document.createElement('div');
                row.className = "channels-row";
                
                dataGroups[gName].forEach(ch => {
                    let card = document.createElement('div');
                    card.className = "card";
                    card.tabIndex = "0";
                    card.innerHTML = `
                        <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/180x110/111/444?text=TV'">
                        <div class="card-name">${ch.name}</div>
                    `;
                    card.onclick = () => playInVLC(ch.url);
                    row.appendChild(card);
                });
                section.appendChild(row);
                container.appendChild(section);
            }
        }

        function playInVLC(url) {
            window.location.href = `intent:${url}#Intent;package=org.videolan.vlc;type=video/*;end`;
        }

        // البحث الذكي
        document.getElementById('search-input').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            let filteredGroups = {};
            for (let g in groups) {
                let filtered = groups[g].filter(ch => ch.name.toLowerCase().includes(term));
                if (filtered.length > 0) filteredGroups[g] = filtered;
            }
            render(filteredGroups);
        });

        // نظام تحكم الريموت الاحترافي
        document.addEventListener('keydown', (e) => {
            const active = document.activeElement;
            if (e.key === "ArrowRight") active.nextElementSibling?.focus();
            if (e.key === "ArrowLeft") active.previousElementSibling?.focus();
            if (e.key === "ArrowDown") {
                if (active.id === "search-input") {
                    document.querySelector('.card')?.focus();
                } else {
                    let nextRow = active.parentElement.parentElement.nextElementSibling;
                    nextRow?.querySelector('.card')?.focus();
                }
            }
            if (e.key === "ArrowUp") {
                let prevRow = active.parentElement.parentElement.previousElementSibling;
                if (!prevRow || prevRow.className !== "channels-row") {
                    document.getElementById('search-input').focus();
                } else {
                    prevRow.querySelector('.card')?.focus();
                }
            }
            if (e.key === "Enter" && active.classList.contains('card')) active.click();
            if (e.key === "Backspace") window.location.href = "index.html";
        });

        loadLive();
    </script>
</body>
</html>