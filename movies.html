<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>أفلام SINMAR+</title>
    <style>
        :root { --bg: #050505; --cyan: #00E5FF; --card-w: 160px; --card-h: 240px; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px 50px; overflow-x: hidden; }
        
        /* الهيدر والبحث */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; position: sticky; top: 0; background: var(--bg); z-index: 100; padding: 10px 0; }
        .logo { font-size: 28px; font-weight: 900; }
        .logo span { color: var(--cyan); }
        .search-box { background: #111; border: 2px solid #333; padding: 10px 20px; border-radius: 30px; width: 400px; display: flex; align-items: center; }
        .search-box input { background: transparent; border: none; color: white; width: 100%; font-size: 18px; outline: none; }
        .search-box:focus-within { border-color: var(--cyan); }

        /* شبكة الأفلام */
        .movies-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(var(--card-w), 1fr)); gap: 25px; }
        .card { 
            width: var(--card-w); height: var(--card-h); background: #1a1a1a; border-radius: 10px; 
            border: 4px solid transparent; transition: 0.3s; position: relative; cursor: pointer;
        }
        .card:focus { border-color: var(--cyan); transform: scale(1.1); z-index: 10; outline: none; }
        .card img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; }
        .card-name { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); font-size: 12px; padding: 5px; text-align: center; }
        
        #loader { text-align: center; padding: 50px; font-size: 24px; color: var(--cyan); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="logo">SINMAR<span>+</span> | الأفلام</div>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="ابحث عن فيلم بالريموت..." tabindex="0">
        </div>
        <div style="color: #666;">اضغط BACK للعودة</div>
    </div>

    <div id="loader">جاري تحميل مكتبة الأفلام...</div>
    <div class="movies-grid" id="movies-grid"></div>

    <script>
        let allMovies = [];

        async function loadMovies() {
            try {
                const res = await fetch('fetch.php');
                const data = await res.text();
                parseData(data);
            } catch (e) { document.getElementById('loader').innerText = "خطأ في الاتصال"; }
        }

        function parseData(data) {
            const lines = data.split('\n');
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes("#EXTINF")) {
                    let group = lines[i].match(/group-title="([^"]+)"/)?.[1] || "";
                    let stream = lines[i+1]?.trim();
                    
                    // فرز الأفلام فقط (استبعاد القنوات والمسلسلات)
                    if (stream.includes(".mp4") || stream.includes(".mkv") || group.includes("أفلام") || group.includes("MOVIES")) {
                        if (!lines[i].toLowerCase().includes("series")) {
                            allMovies.push({
                                name: lines[i].split(',').pop().trim(),
                                logo: lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "",
                                url: stream
                            });
                        }
                    }
                    i++;
                }
            }
            render(allMovies);
            document.getElementById('loader').style.display = 'none';
        }

        function render(movies) {
            const grid = document.getElementById('movies-grid');
            grid.innerHTML = movies.map(m => `
                <div class="card" tabindex="0" onclick="playInVLC('${m.url}')">
                    <img src="${m.logo}" onerror="this.src='https://via.placeholder.com/160x240/111/444?text=NO+IMAGE'">
                    <div class="card-name">${m.name}</div>
                </div>
            `).join('');
        }

        // تشغيل الفيديو في VLC (يدعم الـ Android Intent عند التحويل لـ APK)
        function playInVLC(url) {
            // كود الـ Intent لفتح VLC مباشرة
            const vlcIntent = `intent:${url}#Intent;package=org.videolan.vlc;type=video/*;end`;
            window.location.href = vlcIntent;
        }

        // نظام البحث
        document.getElementById('search-input').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allMovies.filter(m => m.name.toLowerCase().includes(term));
            render(filtered);
        });

        // تحكم الريموت
        document.addEventListener('keydown', (e) => {
            const active = document.activeElement;
            const cards = document.querySelectorAll('.card');
            
            if (e.key === "ArrowRight") active.nextElementSibling?.focus();
            if (e.key === "ArrowLeft") active.previousElementSibling?.focus();
            if (e.key === "ArrowDown") {
                // البحث عن العنصر الذي يقع تحته في الشبكة
                const index = Array.from(cards).indexOf(active);
                const columns = Math.floor(window.innerWidth / 185);
                cards[index + columns]?.focus();
            }
            if (e.key === "ArrowUp") {
                const index = Array.from(cards).indexOf(active);
                const columns = Math.floor(window.innerWidth / 185);
                if (index < columns) document.getElementById('search-input').focus();
                else cards[index - columns]?.focus();
            }
            if (e.key === "Enter" && active.classList.contains('card')) active.click();
            if (e.key === "Escape" || e.key === "Backspace") window.location.href = "index.html";
        });

        loadMovies();
    </script>
</body>
</html>